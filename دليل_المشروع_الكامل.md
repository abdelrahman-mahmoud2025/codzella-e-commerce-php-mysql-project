# 🛒 دليل بناء متجر CodeZilla الإلكتروني من الصفر

---

## 📖 المقدمة

الملف ده هو دليلك الشامل لبناء مشروع متجر إلكتروني احترافي من الصفر باستخدام **PHP** و **MySQL**.

### 🎯 هتتعلم إيه؟

- إزاي تبني **نظام MVC** يدوي من الصفر (بدون فريموورك)
- إزاي تتعامل مع **قاعدة بيانات MySQL** بشكل آمن
- إزاي تعمل **نظام تسجيل دخول** و **صلاحيات** (عملاء وأدمن)
- إزاي تبني **سلة تسوق** (Shopping Cart)
- إزاي تتعامل مع **الدفع الإلكتروني** باستخدام Stripe
- إزاي تأمن موقعك ضد **الاختراقات** (SQL Injection, XSS, CSRF)

### 🏗️ إيه هو المشروع ده؟

**CodeZilla Store** هو متجر إلكتروني متكامل فيه:
- **واجهة للعملاء**: يقدروا يتصفحوا المنتجات، يضيفوا للسلة، ويشتروا
- **لوحة تحكم للأدمن**: إدارة المنتجات، التصنيفات، والطلبات
- **نظام طلبات**: متابعة حالة الطلب من البداية للنهاية
- **دفع إلكتروني**: تكامل مع Stripe للدفع الآمن

---

## 🗂️ فهم هيكل المشروع (البيت اللي هنبنيه)

تخيل إنك بتبني بيت من 4 طوابق. كل طابق ليه دوره:

```
codezilla-store/              # "البيت الرئيسي"
│
├── config/                   # 🔧 "غرفة المحركات" - إعدادات المشروع
│   ├── env.php              # ملف الإعدادات السرية (باسوورد قاعدة البيانات، مفاتيح Stripe)
│   ├── env.example.php      # نموذج ملف الإعدادات (للمشاركة مع الفريق)
│   ├── database.php         # "الموصل" - الاتصال بقاعدة البيانات
│   └── database.sql         # "المخطط" - تصميم الجداول والبيانات التجريبية
│
├── app/                      # 🧠 "العقل المدبر" - كل اللوجيك والكود الأساسي
│   ├── controllers/         # "المديرين" - بيستقبلوا الطلبات ويوجهوها
│   │   ├── HomeController.php
│   │   ├── AuthController.php       # مدير تسجيل الدخول/الخروج
│   │   ├── ProductController.php    # مدير عرض المنتجات
│   │   ├── CartController.php       # مدير سلة التسوق
│   │   ├── OrderController.php      # مدير الطلبات
│   │   └── AdminController.php      # مدير لوحة التحكم
│   │
│   ├── models/              # "المخزن الذكي" - التعامل مع البيانات في قاعدة البيانات
│   │   ├── User.php         # التعامل مع بيانات المستخدمين
│   │   ├── Category.php     # التعامل مع التصنيفات
│   │   ├── Product.php      # التعامل مع المنتجات
│   │   └── Order.php        # التعامل مع الطلبات
│   │
│   └── helpers/             # "صندوق العدة" - أدوات مساعدة
│       ├── SessionHelper.php        # إدارة الجلسات
│       ├── ValidationHelper.php     # التحقق من البيانات
│       ├── CartHelper.php           # عمليات السلة
│       └── StripeHelper.php         # التعامل مع Stripe
│
├── views/                    # 🎨 "الواجهات" - كل اللي المستخدم بيشوفه
│   ├── layouts/             # القوالب الثابتة (Header, Footer)
│   ├── home/                # صفحة الرئيسية
│   ├── auth/                # صفحات تسجيل الدخول والتسجيل
│   ├── products/            # صفحات المنتجات
│   ├── cart/                # صفحة السلة
│   ├── orders/              # صفحات الطلبات
│   ├── admin/               # صفحات لوحة التحكم
│   └── errors/              # صفحات الأخطاء (404)
│
├── public/                   # 🌐 "الباب الأمامي" - الملفات العامة
│   ├── index.php            # "البواب" - نقطة دخول المشروع
│   ├── .htaccess            # قواعد إعادة التوجيه (Clean URLs)
│   ├── css/                 # ملفات التنسيق
│   └── js/                  # ملفات JavaScript
│
├── uploads/                  # 📁 "المخزن" - الصور المرفوعة
│
├── composer.json             # 📦 "قائمة المشتريات" - المكتبات المطلوبة
└── .htaccess                 # إعدادات Apache الرئيسية
```

---

## 🚀 الجزء الأول: البداية من الصفر

### 📋 المتطلبات (الأدوات اللي محتاجها قبل ما تبدأ)

#### 1. **XAMPP** (أو WAMP أو MAMP)
- **إيه ده؟** برنامج بيجيبلك Apache + MySQL + PHP في حزمة واحدة
- **تنزله منين؟** https://www.apachefriends.org
- **ليه محتاجه؟** عشان تقدر تشغل كود PHP على جهازك

#### 2. **PHP 8.0 أو أعلى**
- بييجي مع XAMPP عادةً
- للتأكد: افتح CMD واكتب `php -v`

#### 3. **Composer**
- **إيه ده؟** مدير الحزم بتاع PHP
- **تنزله منين؟** https://getcomposer.org
- **ليه محتاجه؟** عشان نثبت مكتبة Stripe

#### 4. **محرر أكواد** (VS Code مثلاً)
- تنزله من https://code.visualstudio.com

---

### 🛠️ خطوة 1: تجهيز بيئة العمل

#### تشغيل XAMPP
1. افتح XAMPP Control Panel
2. شغّل Apache (اضغط Start)
3. شغّل MySQL (اضغط Start)
4. لو الاتنين شغالين يبقى تمام ✅

#### تجهيز المجلد
1. روح `C:\xampp\htdocs\`
2. اعمل مجلد اسمه `codezilla-store`
3. افتحه في VS Code

---

### 📂 خطوة 2: إنشاء هيكل المجلدات

```bash
cd C:\xampp\htdocs\codezilla-store

# المجلدات الرئيسية
mkdir app config public views uploads

# مجلدات app
mkdir app\controllers app\models app\helpers

# مجلدات views
mkdir views\layouts views\home views\auth views\products
mkdir views\cart views\orders views\admin views\errors

# مجلدات admin
mkdir views\admin\products views\admin\orders views\admin\categories

# مجلدات public
mkdir public\css public\js
```

---

## 🗄️ الجزء الثاني: قاعدة البيانات

### خطوة 3: إنشاء قاعدة البيانات

#### أ) افتح phpMyAdmin
1. في المتصفح: `http://localhost/phpmyadmin`
2. اضغط "New" من الجانب
3. اسم القاعدة: `codezilla_store`
4. Collation: `utf8mb4_unicode_ci`
5. اضغط Create ✅

#### ب) تنفيذ ملف SQL

اعمل ملف `config/database.sql` بالكود ده (ملخص):

**الجداول المطلوبة:**
- `users` - المستخدمين (عملاء وأدمن)
- `categories` - التصنيفات
- `products` - المنتجات
- `orders` - الطلبات
- `order_items` - تفاصيل كل طلب

**طريقة التنفيذ:**
1. في phpMyAdmin اختار `codezilla_store`
2. تاب "SQL"
3. انسخ محتوى الملف `config/database.sql` الموجود في المشروع
4. اضغط "Go" ✅

**بيانات تجريبية هتتضاف:**
- أدمن: `admin@codezilla.com` / `admin123`
- 4 تصنيفات
- 4 منتجات تجريبية

---

## ⚙️ الجزء الثالث: ملفات الإعدادات

### خطوة 4: ملف الإعدادات `config/env.php`

```php
<?php
define('DB_HOST', 'localhost');
define('DB_NAME', 'codezilla_store');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_CHARSET', 'utf8mb4');

define('APP_NAME', 'CodeZilla Store');
define('APP_URL', 'http://localhost/codezilla-store/public');
define('APP_ENV', 'development');

define('STRIPE_PUBLIC_KEY', 'pk_test_YOUR_KEY');
define('STRIPE_SECRET_KEY', 'sk_test_YOUR_KEY');

define('SESSION_LIFETIME', 7200);
define('UPLOAD_DIR', __DIR__ . '/../uploads/');
define('MAX_FILE_SIZE', 5242880);
define('ALLOWED_EXTENSIONS', ['jpg', 'jpeg', 'png', 'gif', 'webp']);

define('CSRF_TOKEN_NAME', 'csrf_token');
define('PASSWORD_MIN_LENGTH', 8);
```

---

### خطوة 5: ملف الاتصال `config/database.php`

**شرح الفكرة:** ده الملف اللي بيتصل بقاعدة البيانات. بنستخدم **Singleton Pattern** عشان يكون فيه اتصال واحد بس.

```php
<?php
class Database {
    private static $instance = null;
    private $connection;

    private function __construct() {
        try {
            $dsn = "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET;
            $options = [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                PDO::ATTR_EMULATE_PREPARES => false,
            ];
            $this->connection = new PDO($dsn, DB_USER, DB_PASS, $options);
        } catch (PDOException $e) {
            die("فشل الاتصال: " . $e->getMessage());
        }
    }

    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    public function getConnection() {
        return $this->connection;
    }

    private function __clone() {}
}
```

**استخدام الكلاس:**
```php
$db = Database::getInstance();
$conn = $db->getConnection();
```

---

## 🚪 الجزء الرابع: نقطة الدخول (البواب)

### خطوة 6: ملف `public/index.php`

ده **أهم ملف** في المشروع! كل الطلبات بتمر عليه.

**الفكرة:** 
- لما المستخدم يكتب `/products` → البواب يوجهه لـ ProductController
- لما يكتب `/cart/add` → يوجهه لـ CartController والدالة add

```php
<?php
session_start();

// تحميل الإعدادات
require_once __DIR__ . '/../config/env.php';
require_once __DIR__ . '/../config/database.php';

// تحميل الـ Helpers
require_once __DIR__ . '/../app/helpers/SessionHelper.php';
require_once __DIR__ . '/../app/helpers/ValidationHelper.php';
require_once __DIR__ . '/../app/helpers/CartHelper.php';
require_once __DIR__ . '/../app/helpers/StripeHelper.php';

// تحميل الـ Models
require_once __DIR__ . '/../app/models/User.php';
require_once __DIR__ . '/../app/models/Category.php';
require_once __DIR__ . '/../app/models/Product.php';
require_once __DIR__ . '/../app/models/Order.php';

// تحميل الـ Controllers
require_once __DIR__ . '/../app/controllers/HomeController.php';
require_once __DIR__ . '/../app/controllers/AuthController.php';
require_once __DIR__ . '/../app/controllers/ProductController.php';
require_once __DIR__ . '/../app/controllers/CartController.php';
require_once __DIR__ . '/../app/controllers/OrderController.php';
require_once __DIR__ . '/../app/controllers/AdminController.php';

// قراءة الـ URL
$url = isset($_GET['url']) ? rtrim($_GET['url'], '/') : '';
$url = filter_var($url, FILTER_SANITIZE_URL);
$url = explode('/', $url);

// القيم الافتراضية
$controller = 'HomeController';
$method = 'index';
$params = [];

// توجيه الطلبات
if (!empty($url[0])) {
    switch ($url[0]) {
        case 'login':
            $controller = 'AuthController';
            $method = 'login';
            break;
        case 'register':
            $controller = 'AuthController';
            $method = 'register';
            break;
        case 'logout':
            $controller = 'AuthController';
            $method = 'logout';
            break;
        case 'products':
            $controller = 'ProductController';
            $method = isset($url[1]) ? $url[1] : 'index';
            $params = array_slice($url, 2);
            break;
        case 'cart':
            $controller = 'CartController';
            $method = isset($url[1]) ? $url[1] : 'index';
            $params = array_slice($url, 2);
            break;
        case 'orders':
            $controller = 'OrderController';
            $method = isset($url[1]) ? $url[1] : 'index';
            $params = array_slice($url, 2);
            break;
        case 'admin':
            $controller = 'AdminController';
            $method = isset($url[1]) ? $url[1] : 'dashboard';
            $params = array_slice($url, 2);
            break;
        default:
            $controller = 'HomeController';
            $method = 'notFound';
    }
}

// تشغيل الـ Controller
try {
    $controllerInstance = new $controller();
    if (method_exists($controllerInstance, $method)) {
        call_user_func_array([$controllerInstance, $method], $params);
    } else {
        $homeController = new HomeController();
        $homeController->notFound();
    }
} catch (Exception $e) {
    if (APP_ENV === 'development') {
        die("Error: " . $e->getMessage());
    } else {
        die("حدث خطأ. حاول مرة أخرى.");
    }
}
```

---

### خطوة 7: ملف `public/.htaccess`

ده ملف بيخلي الروابط نضيفة (بدون `?url=`)

```apache
RewriteEngine On
RewriteBase /codezilla-store/public/

# لو الملف أو المجلد موجود، اعرضه
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# لو مش موجود، وجّه لـ index.php
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]
```

**النتيجة:**
- بدلاً من: `index.php?url=products/show/1`
- هيبقى: `/products/show/1` ✨

---

## 🧠 الجزء الخامس: فهم نمط MVC

### ما هو MVC؟

**MVC** = Model + View + Controller

**تشبيه المطعم:**
- **Model** (النادل): يروح للمطبخ (قاعدة البيانات) يجيب الطلب
- **View** (الطبق): الشكل النهائي اللي بيتقدم للزبون
- **Controller** (المدير): يستقبل طلب الزبون ويوجه النادل

**مثال عملي:** لما المستخدم يطلب `/products`:
1. **Controller** يستقبل الطلب
2. **Model** يجيب المنتجات من قاعدة البيانات
3. **View** يعرض المنتجات بشكل جميل

---

## 📦 الجزء السادس: الـ Models

### خطوة 8: User Model (مثال)

الـ Model مسؤول عن التعامل مع قاعدة البيانات فقط.

**الوظائف الأساسية:**
- `getAll()` - جلب كل السجلات
- `getById($id)` - جلب سجل واحد
- `create($data)` - إضافة سجل جديد
- `update($id, $data)` - تحديث سجل
- `delete($id)` - حذف سجل

**نقاط مهمة:**
- ✅ استخدم **Prepared Statements** دائماً (حماية من SQL Injection)
- ✅ استخدم `password_hash()` لتشفير كلمات المرور
- ✅ استخدم `password_verify()` للتحقق من كلمة المرور

---

## 🎮 الجزء السابع: الـ Controllers

### خطوة 9: HomeController

```php
<?php
class HomeController {
    private $productModel;

    public function __construct() {
        $this->productModel = new Product();
    }

    public function index() {
        $featuredProducts = $this->productModel->getFeatured(8);
        $latestProducts = $this->productModel->getAll(12);

        require_once __DIR__ . '/../../views/layouts/header.php';
        require_once __DIR__ . '/../../views/home/index.php';
        require_once __DIR__ . '/../../views/layouts/footer.php';
    }

    public function notFound() {
        http_response_code(404);
        require_once __DIR__ . '/../../views/errors/404.php';
    }
}
```

**شرح:**
- `__construct()`: ينفذ أول ما ننشئ الكائن
- `index()`: الدالة الافتراضية للصفحة الرئيسية
- نستدعي الـ Model نجيب البيانات
- نستدعي الـ Views نعرض البيانات

---

### خطوة 10: AuthController (تسجيل الدخول)

```php
<?php
class AuthController {
    private $userModel;

    public function __construct() {
        $this->userModel = new User();
    }

    public function login() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $email = $_POST['email'] ?? '';
            $password = $_POST['password'] ?? '';

            $user = $this->userModel->login($email, $password);

            if ($user) {
                $_SESSION['user_id'] = $user['id'];
                $_SESSION['user_name'] = $user['full_name'];
                $_SESSION['user_role'] = $user['role'];
                
                header('Location: ' . APP_URL);
                exit;
            } else {
                $error = 'البريد أو كلمة المرور غير صحيحة';
            }
        }

        require_once __DIR__ . '/../../views/auth/login.php';
    }

    public function logout() {
        session_destroy();
        header('Location: ' . APP_URL);
        exit;
    }
}
```

**شرح:**
- نتحقق من الـ Method (POST أو GET)
- لو POST: نعالج البيانات
- لو GET: نعرض الفورم
- بعد النجاح: نحفظ البيانات في الـ Session

---

## 🎨 الجزء الثامن: الـ Views (الواجهات)

### خطوة 11: Header Layout

ملف `views/layouts/header.php`:

```php
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= APP_NAME ?></title>
    <link rel="stylesheet" href="<?= APP_URL ?>/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="<?= APP_URL ?>" class="logo"><?= APP_NAME ?></a>
            <ul class="nav-links">
                <li><a href="<?= APP_URL ?>">الرئيسية</a></li>
                <li><a href="<?= APP_URL ?>/products">المنتجات</a></li>
                
                <?php if (isset($_SESSION['user_id'])): ?>
                    <li><a href="<?= APP_URL ?>/cart">السلة</a></li>
                    <li><a href="<?= APP_URL ?>/orders">طلباتي</a></li>
                    
                    <?php if ($_SESSION['user_role'] === 'admin'): ?>
                        <li><a href="<?= APP_URL ?>/admin">لوحة التحكم</a></li>
                    <?php endif; ?>
                    
                    <li><a href="<?= APP_URL ?>/logout">تسجيل خروج</a></li>
                <?php else: ?>
                    <li><a href="<?= APP_URL ?>/login">تسجيل دخول</a></li>
                    <li><a href="<?= APP_URL ?>/register">إنشاء حساب</a></li>
                <?php endif; ?>
            </ul>
        </div>
    </nav>
    <main>
```

---

### خطوة 12: صفحة تسجيل الدخول

ملف `views/auth/login.php`:

```php
<div class="auth-container">
    <form method="POST" class="auth-form">
        <h2>تسجيل الدخول</h2>
        
        <?php if (isset($error)): ?>
            <div class="alert alert-error"><?= htmlspecialchars($error) ?></div>
        <?php endif; ?>
        
        <div class="form-group">
            <label>البريد الإلكتروني</label>
            <input type="email" name="email" required>
        </div>
        
        <div class="form-group">
            <label>كلمة المرور</label>
            <input type="password" name="password" required>
        </div>
        
        <button type="submit" class="btn btn-primary">دخول</button>
        
        <p>ليس لديك حساب؟ <a href="<?= APP_URL ?>/register">سجل الآن</a></p>
    </form>
</div>
```

**نقاط الأمان:**
- ✅ استخدم `htmlspecialchars()` لعرض أي نص من المستخدم (حماية من XSS)
- ✅ استخدم `method="POST"` للبيانات الحساسة
- ✅ أضف `required` في الحقول المطلوبة

---

## 🛡️ الجزء التاسع: الـ Helpers (الأدوات المساعدة)

### خطوة 13: SessionHelper

ملف `app/helpers/SessionHelper.php`:

```php
<?php
class SessionHelper {
    public static function set($key, $value) {
        $_SESSION[$key] = $value;
    }

    public static function get($key, $default = null) {
        return $_SESSION[$key] ?? $default;
    }

    public static function has($key) {
        return isset($_SESSION[$key]);
    }

    public static function delete($key) {
        unset($_SESSION[$key]);
    }

    public static function destroy() {
        session_destroy();
    }

    public static function isLoggedIn() {
        return self::has('user_id');
    }

    public static function isAdmin() {
        return self::get('user_role') === 'admin';
    }

    public static function requireLogin() {
        if (!self::isLoggedIn()) {
            header('Location: ' . APP_URL . '/login');
            exit;
        }
    }

    public static function requireAdmin() {
        self::requireLogin();
        if (!self::isAdmin()) {
            header('Location: ' . APP_URL);
            exit;
        }
    }
}
```

**الاستخدام:**
```php
SessionHelper::set('user_id', 1);
SessionHelper::requireAdmin(); // يتأكد المستخدم أدمن
```

---

## 🛒 الجزء العاشر: سلة التسوق (Shopping Cart)

### خطوة 14: CartHelper

ملف `app/helpers/CartHelper.php`:

```php
<?php
class CartHelper {
    // إضافة منتج للسلة
    public static function add($productId, $quantity = 1) {
        if (!isset($_SESSION['cart'])) {
            $_SESSION['cart'] = [];
        }

        if (isset($_SESSION['cart'][$productId])) {
            $_SESSION['cart'][$productId] += $quantity;
        } else {
            $_SESSION['cart'][$productId] = $quantity;
        }
    }

    // تحديث كمية منتج
    public static function update($productId, $quantity) {
        if ($quantity <= 0) {
            self::remove($productId);
        } else {
            $_SESSION['cart'][$productId] = $quantity;
        }
    }

    // حذف منتج من السلة
    public static function remove($productId) {
        unset($_SESSION['cart'][$productId]);
    }

    // إفراغ السلة
    public static function clear() {
        $_SESSION['cart'] = [];
    }

    // جلب محتويات السلة
    public static function getItems() {
        return $_SESSION['cart'] ?? [];
    }

    // حساب الإجمالي
    public static function getTotal() {
        $total = 0;
        $productModel = new Product();
        
        foreach (self::getItems() as $productId => $quantity) {
            $product = $productModel->getById($productId);
            if ($product) {
                $price = $product['sale_price'] ?? $product['price'];
                $total += $price * $quantity;
            }
        }
        
        return $total;
    }

    // عدد المنتجات في السلة
    public static function getCount() {
        return array_sum(self::getItems());
    }
}
```

---

### خطوة 15: CartController

```php
<?php
class CartController {
    private $productModel;

    public function __construct() {
        SessionHelper::requireLogin();
        $this->productModel = new Product();
    }

    public function index() {
        $cartItems = CartHelper::getItems();
        $items = [];
        $total = 0;

        foreach ($cartItems as $productId => $quantity) {
            $product = $this->productModel->getById($productId);
            if ($product) {
                $price = $product['sale_price'] ?? $product['price'];
                $items[] = [
                    'product' => $product,
                    'quantity' => $quantity,
                    'subtotal' => $price * $quantity
                ];
                $total += $price * $quantity;
            }
        }

        require_once __DIR__ . '/../../views/layouts/header.php';
        require_once __DIR__ . '/../../views/cart/index.php';
        require_once __DIR__ . '/../../views/layouts/footer.php';
    }

    public function add() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $productId = $_POST['product_id'] ?? 0;
            $quantity = $_POST['quantity'] ?? 1;

            CartHelper::add($productId, $quantity);
            
            header('Location: ' . APP_URL . '/cart');
            exit;
        }
    }

    public function update() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $productId = $_POST['product_id'] ?? 0;
            $quantity = $_POST['quantity'] ?? 1;

            CartHelper::update($productId, $quantity);
            
            header('Location: ' . APP_URL . '/cart');
            exit;
        }
    }

    public function remove($productId) {
        CartHelper::remove($productId);
        header('Location: ' . APP_URL . '/cart');
        exit;
    }
}
```

---

## 💳 الجزء الحادي عشر: الدفع الإلكتروني (Stripe)

### خطوة 16: تثبيت Stripe

في Terminal:
```bash
composer require stripe/stripe-php
```

### خطوة 17: StripeHelper

ملف `app/helpers/StripeHelper.php`:

```php
<?php
require_once __DIR__ . '/../../vendor/autoload.php';

class StripeHelper {
    public static function createCheckoutSession($orderId, $items) {
        \Stripe\Stripe::setApiKey(STRIPE_SECRET_KEY);

        $lineItems = [];
        foreach ($items as $item) {
            $lineItems[] = [
                'price_data' => [
                    'currency' => 'usd',
                    'product_data' => [
                        'name' => $item['product']['name'],
                    ],
                    'unit_amount' => $item['product']['price'] * 100, // بالسنت
                ],
                'quantity' => $item['quantity'],
            ];
        }

        $session = \Stripe\Checkout\Session::create([
            'payment_method_types' => ['card'],
            'line_items' => $lineItems,
            'mode' => 'payment',
            'success_url' => APP_URL . '/orders/success?order_id=' . $orderId,
            'cancel_url' => APP_URL . '/orders/cancel?order_id=' . $orderId,
        ]);

        return $session;
    }
}
```

---

## 🎓 الجزء الثاني عشر: نصائح للتطبيق

### ترتيب بناء المشروع (خطوة بخطوة)

1. **ابدأ بالإعدادات** ✅
   - `config/env.php`
   - `config/database.php`
   - `config/database.sql`

2. **بعدها المجلدات والملفات الأساسية** ✅
   - `public/index.php`
   - `public/.htaccess`

3. **بعدها الـ Helpers** ✅
   - `SessionHelper.php`
   - `ValidationHelper.php`
   - `CartHelper.php`

4. **بعدها الـ Models** ✅
   - `User.php`
   - `Category.php`
   - `Product.php`
   - `Order.php`

5. **بعدها الـ Controllers** ✅
   - `HomeController.php`
   - `AuthController.php`
   - `ProductController.php`
   - `CartController.php`
   - `OrderController.php`
   - `AdminController.php`

6. **أخيراً الـ Views** ✅
   - `layouts/header.php` و `footer.php`
   - باقي الصفحات حسب الحاجة

---

### أخطاء شائعة وحلولها

#### ❌ خطأ: "Call to undefined function"
**السبب:** نسيت تعمل `require_once` للملف
**الحل:** تأكد إنك حمّلت كل الملفات في `public/index.php`

#### ❌ خطأ: "404 Not Found" في كل الصفحات
**السبب:** ملف `.htaccess` مش موجود أو `mod_rewrite` مش مفعّل
**الحل:** تأكد من وجود الملف وتفعيل `mod_rewrite` في Apache

#### ❌ خطأ: "Access denied for user"
**السبب:** بيانات قاعدة البيانات غلط في `env.php`
**الحل:** راجع الباسوورد واسم المستخدم

#### ❌ خطأ: الصور مش بتظهر
**السبب:** المسار غلط أو المجلد مالوش صلاحيات
**الحل:** تأكد من `chmod 755 uploads/`

---

## 🎯 الخلاصة والخطوات التالية

### ✅ ما أنجزناه

بعد اتباع هذا الدليل، يكون عندك:
- ✅ متجر إلكتروني كامل بنظام MVC
- ✅ نظام تسجيل دخول آمن
- ✅ إدارة منتجات وتصنيفات
- ✅ سلة تسوق
- ✅ نظام طلبات
- ✅ تكامل مع Stripe للدفع
- ✅ لوحة تحكم للأدمن

### 📚 للتطوير أكثر

**ميزات إضافية تقدر تضيفها:**
- 🔍 نظام بحث متقدم
- ⭐ تقييمات ومراجعات المنتجات
- 📧 إرسال إيميلات تأكيد
- 📱 تصميم متجاوب (Responsive)
- 🌍 دعم لغات متعددة
- 📊 تقارير مبيعات متقدمة
- 🎫 كوبونات خصم
- 📦 تتبع الشحن

### 🔒 نصائح الأمان النهائية

1. **لا تنسخ الملفات الحساسة على Git**
   - أضف `config/env.php` في `.gitignore`

2. **استخدم HTTPS في الإنتاج**
   - لا تنشر الموقع بدون SSL

3. **غيّر الباسوورد الافتراضي للأدمن**
   - `admin123` للتجربة فقط!

4. **فعّل Error Reporting بحذر**
   - في الإنتاج خليها `APP_ENV = production`

5. **عمل Backup دوري**
   - احفظ نسخة من قاعدة البيانات

---

## 📞 الدعم والمساعدة

**مصادر مفيدة:**
- [توثيق PHP الرسمي](https://www.php.net/docs.php)
- [توثيق MySQL](https://dev.mysql.com/doc/)
- [Stripe API Docs](https://stripe.com/docs/api)

**أسئلة شائعة:**
- المشروع موجود في `C:\xampp\htdocs\codezilla-store`
- الرابط: `http://localhost/codezilla-store/public`
- phpMyAdmin: `http://localhost/phpmyadmin`

---

## 🎉 مبروك!

أنت الآن عندك فهم كامل لبناء متجر إلكتروني من الصفر باستخدام PHP و MySQL!

**لا تتوقف هنا:**
- جرب تضيف ميزات جديدة
- اقرأ عن Design Patterns
- تعلم Laravel (فريموورك PHP احترافي)
- ابني مشاريع أكثر

**حظ موفق في رحلتك البرمجية! 🚀**

